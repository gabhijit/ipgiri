#
# Refer to LICENSE file and README file for licensing information.
#
from datetime import datetime as dt

from mrtdump import MRTDumper
from asinformation import ASInformation
from ipv4_routing_table import RouteTable
from mrttypes import PeerIndexTable, RIBEntry

a = ASInformation('20230701.as-org2info.txt.gz')
r = RouteTable()
dumper = MRTDumper('rib.20230626.0400.bz2')

count = 0
for dump in dumper:
    if type(dump) == PeerIndexTable:
        dumper._peeridx_tbl = dump
    if type(dump) == RIBEntry:
        prefix, length, asid =  dump.get_prefix_length_dest_as()
        if length > 0:
            r.add(prefix, length, asid)
        #r.print_table()
        #dumper._rib_entries.append(dump)
    count += 1
    if count % 1000 == 0:
        print(count, prefix, length, asid, r.rtentries_alloced)

r.save_table('585kentries.table')
print(r.lookup('123.252.240.140'))


ip_addresses = """231.231.100.42
161.97.138.70
113.240.46.106
91.195.192.126
128.39.30.226
189.14.22.125
140.120.96.234
114.218.5.98
91.210.192.232
156.250.93.230
1.178.169.251
103.32.142.8
195.243.204.94
149.75.59.141
109.252.182.17
179.87.175.54
159.214.31.125
253.61.135.29
209.211.59.148
194.85.24.102
170.70.61.124
183.28.195.75
137.77.157.13
112.13.106.234
78.59.10.187
96.63.89.112
225.112.168.114
76.224.228.23
196.122.107.104
80.228.9.7
165.45.28.16
41.109.94.9
141.42.148.5
170.214.96.144
196.168.75.190
177.63.59.236
10.115.242.147
67.3.162.106
69.40.72.110
245.111.248.36
146.213.32.229
73.118.153.205
68.100.199.61
191.116.195.82
101.234.237.62
66.98.118.182
204.212.169.65
114.210.199.228
41.96.2.135
125.39.161.30
17.245.3.137
145.132.188.107
70.39.125.230
150.69.145.114
115.43.228.100
84.0.181.45
156.136.228.101
232.147.199.196
125.17.178.157
212.226.184.148
227.91.147.150
236.164.8.16
216.58.248.218
167.228.123.28
128.5.227.57
98.107.222.21
223.116.48.196
73.7.190.160
116.245.203.165
10.73.219.116
180.1.59.252
246.174.170.89
186.134.233.239
74.147.24.54
19.63.253.79
204.132.153.254
76.230.53.157
121.195.177.208
94.73.105.88
159.33.7.77
85.167.51.123
96.174.124.67
202.72.180.123
146.157.198.187
185.13.67.59
204.11.99.130
214.144.81.155
101.69.160.174
95.87.83.143
102.61.138.248
224.253.227.150
142.186.7.144
151.81.238.240
130.99.47.170
22.36.68.229
254.197.74.101
147.167.89.113
14.240.44.237
77.151.66.4
68.150.149.4
24.129.248.31
110.221.24.78
218.146.67.184
29.200.221.135
150.166.24.90
88.173.57.78
125.20.37.35
146.183.238.3
34.85.150.6
166.241.114.217
72.229.17.48
108.49.19.154
140.152.240.14
128.196.147.178
120.135.77.217
82.178.105.248
65.8.13.105
13.141.120.88
11.51.86.48
55.88.202.234
236.202.149.21
128.102.219.182
42.201.243.166
59.41.32.175
39.203.40.21
63.45.166.2
55.242.206.177
43.79.199.188
62.195.53.175
135.203.86.138
75.102.215.217
255.162.11.191
224.141.154.121
169.37.136.113
0.96.226.119
126.150.175.76
162.186.124.145
180.228.248.186
8.144.112.164
231.143.242.97
127.253.176.239
62.133.71.196
239.201.101.26
40.37.198.231
73.74.165.217
137.18.64.201
93.221.241.177
231.10.92.45
149.102.60.23
254.112.229.156
25.97.240.161
243.221.177.174
187.233.40.140
106.129.37.91
51.253.172.123
194.161.143.200
58.19.17.208
226.224.124.81
8.19.241.43
37.199.156.217
111.46.131.214
33.112.73.123
65.0.191.130
41.223.120.35
121.165.207.211
86.234.71.125
233.191.240.142
10.118.148.130
71.239.21.207
247.190.197.253
16.179.148.153
85.143.84.196
212.204.83.192
75.221.221.134
108.148.77.137
213.39.108.226
219.222.211.5
207.246.48.85
153.158.105.46
42.40.27.140
73.200.225.106
177.175.69.80
185.101.244.135
137.77.202.30
231.67.87.199
135.197.34.193
232.17.193.24
160.161.231.189
142.163.5.100
82.153.97.95
18.129.222.6
69.109.64.216
49.236.239.31
161.123.241.164
255.180.132.200
52.127.234.69
44.190.82.83
144.42.163.95
185.35.197.47
201.83.93.249
25.196.124.96
160.100.194.231
251.32.96.15
60.141.15.8
20.68.63.127
21.219.75.21
168.40.243.58
174.189.9.219
226.182.167.153
202.189.255.104
45.169.2.194
135.80.126.187
56.222.146.41
204.25.169.88
116.136.50.89
243.111.134.18
248.40.24.14
35.144.44.90
164.217.144.151
74.14.234.27
117.85.67.235
224.208.65.32
235.215.180.42
117.245.144.237
198.95.35.203
14.16.117.219
110.160.181.88
214.46.252.112
218.28.145.173
252.7.38.151
207.97.228.103
85.193.39.130
156.108.142.82
99.146.211.185
104.32.250.186
144.239.227.129
46.183.93.22
31.190.118.188
35.84.45.75
177.195.89.94
8.172.153.8
153.238.105.182
242.126.141.255
200.156.4.140
73.231.103.41
51.40.134.215
154.35.105.108
41.186.140.128
201.201.79.65
108.61.10.49
81.31.140.192
180.175.64.120
94.33.247.207
244.46.153.215
229.107.120.157
29.208.123.172
240.73.196.103
133.231.62.192
231.167.194.203
220.254.142.135
121.135.150.104
45.56.32.26
230.71.151.130
131.33.23.199
40.36.153.206
176.154.211.222
181.224.4.0
52.59.253.173
169.24.23.112
77.85.171.23
140.62.173.102
132.105.132.68
74.181.155.94
181.45.191.146
96.170.208.138
91.143.73.73
9.5.167.143
51.15.94.124
68.144.240.162
213.254.48.240
120.58.44.31
208.53.21.205
218.157.184.12
53.251.169.216
102.219.109.100
32.212.2.61
197.208.92.215
132.225.76.95
73.129.70.21
145.172.50.124
201.195.200.8
197.2.215.236
107.65.145.1
217.129.227.13
229.57.204.103
172.134.128.191
72.79.185.241
230.239.198.24
78.127.85.212
194.66.102.220
43.228.222.102
118.220.145.96
103.63.219.60
157.19.85.195
12.232.238.40
47.187.46.117
244.84.71.68
139.127.187.156
41.245.164.157
141.89.215.170
221.108.81.56
65.159.191.209
63.237.12.72
98.243.68.48
39.98.217.23
245.35.79.97
77.93.88.34
37.87.105.142
124.24.28.252
210.226.205.51
198.211.125.236
36.107.96.24
202.172.240.134
191.80.244.50
75.4.180.65
238.18.186.119
139.78.179.149
220.190.133.249
75.135.233.138
18.113.99.183
127.129.231.123
95.162.136.136
41.241.93.216
111.178.34.94
206.115.250.160
209.32.91.251
4.238.165.163
138.112.217.133
94.108.12.163
150.140.89.44
246.149.114.116
186.75.123.56
121.205.77.234
222.161.202.230
99.96.9.183
188.204.23.131
248.0.178.75
198.144.104.156
3.100.93.81
24.155.233.203
131.195.84.238
140.74.212.70
134.151.164.115
110.171.41.63
153.136.214.168
143.130.190.219
8.22.136.91
5.249.186.183
5.40.126.37
132.209.122.225
34.220.44.149
150.120.239.180
171.211.191.236
55.104.246.126
230.159.173.81
234.207.58.75
240.129.219.10
232.108.20.51
94.184.191.236
49.58.199.27
231.22.40.106
50.102.235.12
103.101.78.22
4.44.10.5
79.150.81.92
71.141.55.133
44.172.212.7
39.22.97.167
225.165.20.33
143.196.84.140
148.143.126.97
190.69.103.9
37.167.253.157
246.176.3.83
143.117.78.98
108.150.100.16
20.81.152.150
109.81.98.82
64.17.226.84
205.172.159.169
14.177.253.87
21.155.29.197
125.208.30.21
51.33.248.218
128.74.130.66
227.229.122.194
244.51.236.89
243.101.187.73
226.69.175.134
81.240.238.207
247.164.22.192
234.64.105.154
24.18.121.239
203.207.114.245
13.103.65.58
102.189.164.62
169.133.185.94
231.36.43.7
19.96.106.168
44.34.189.252
142.8.118.120
62.144.196.229
152.27.233.83
72.59.153.23
251.84.22.239
174.58.193.108
102.107.16.236
30.167.114.14
193.217.48.30
185.7.146.169
192.121.15.214
153.208.126.227
22.196.140.70
247.221.73.50
241.94.110.16
29.101.236.93
46.35.169.243
165.158.6.14
21.21.2.121
51.66.195.177
61.2.123.134
0.232.33.32
125.52.18.15
93.46.30.252
36.118.182.17
20.133.213.104
108.192.127.130
159.179.35.150
184.212.32.243
15.177.176.15
243.156.62.82
81.133.71.188
215.60.73.77
14.82.108.247
128.32.159.52
46.204.50.252
79.212.181.182
202.148.61.18
59.157.223.169
243.54.207.41
26.29.4.55
35.78.143.7
160.127.253.14
125.138.36.225
88.159.238.104
139.186.79.226
4.87.240.14
151.172.141.26
153.86.229.18
7.194.205.61
194.181.250.248
123.88.209.146
158.45.209.20
58.36.249.24
11.4.239.117
221.83.50.62
214.127.98.80
245.33.169.85
62.182.205.221
210.235.45.228
250.236.103.91
218.86.252.37
186.86.82.120
179.204.174.70
71.205.245.211
251.14.247.25
48.141.220.247
201.108.242.20
131.230.241.247
250.194.58.124
18.218.57.4
230.71.235.40
194.88.241.88
83.248.237.111
233.90.56.217
186.150.164.153
186.11.135.133
170.74.93.130
130.248.68.33
160.135.239.28
70.154.89.86
168.32.220.82
232.242.8.167
238.255.217.151
188.33.106.193
56.176.101.204
93.8.92.6
16.96.107.172
178.103.37.157
194.79.122.126
183.119.252.62
66.193.254.181
8.229.128.180
20.147.233.190
12.114.70.104
122.84.250.4
101.27.144.43
188.36.207.252
36.231.35.45
73.230.91.76
55.33.130.43
127.92.154.64
28.60.240.246
170.106.117.147
169.1.37.214
5.130.241.179
223.186.123.87
118.108.124.23
127.218.191.224
128.215.236.89
59.252.7.46
234.30.32.85
6.114.226.97
188.19.12.31
119.92.90.70
34.22.104.8
36.177.203.251
152.100.228.74
155.118.87.68
222.7.61.79
196.164.207.188
243.34.91.161
231.102.162.128
100.83.123.35
244.128.218.203
195.30.181.32
128.225.22.150
30.11.127.216
214.21.180.251
97.42.202.165
42.245.55.213
134.250.102.46
72.132.105.171
229.195.119.17
181.74.13.119
58.103.39.20
250.246.162.206
8.155.172.59
103.150.232.253
21.91.91.245
205.156.144.203
35.170.160.222
104.28.11.122
220.232.102.34
197.125.146.250
33.83.129.228
75.241.230.197
113.82.19.59
240.8.220.171
113.45.30.198
156.121.135.241
211.37.95.104
21.185.78.177
72.186.83.162
87.9.166.211
133.7.220.135
165.79.110.159
132.212.184.248
102.68.186.171
189.121.138.160
88.199.156.118
155.210.0.157
173.2.103.141
73.220.243.177
2.237.183.98
160.18.111.43
230.111.81.135
147.196.194.233
250.238.250.111
20.235.153.194
82.198.178.230
119.19.150.194
195.123.52.131
10.83.111.237
194.27.30.200
225.247.63.20
151.120.189.11
44.147.132.243
105.232.118.142
210.198.254.48
27.152.37.3
9.143.18.158
184.250.81.167
237.208.58.100
103.24.21.52
52.41.166.207
69.136.127.28
251.16.93.177
253.72.188.172
5.165.163.239
85.121.116.246
150.147.82.162
104.236.9.126
58.16.144.31
58.88.220.57
182.234.208.21
128.164.67.122
203.244.92.70
103.5.120.246
83.247.31.246
5.134.69.232
210.41.244.190
176.202.215.46
61.243.23.164
25.160.169.67
22.237.136.92
99.216.170.146
177.41.20.252
156.191.205.216
9.29.94.73
95.130.228.182
138.33.168.19
247.34.113.185
33.33.210.154
223.33.247.233
49.151.25.115
159.133.44.127
45.121.8.95
173.145.44.104
128.255.214.1
61.190.51.143
192.165.162.83
100.79.82.112
184.88.125.26
97.20.125.140
13.121.181.7
70.102.170.147
114.116.58.237
206.112.185.173
181.235.63.219
35.77.109.126
192.203.134.71
42.67.77.223
217.228.189.199
175.30.3.156
212.253.195.101
229.13.33.62
96.229.9.94
121.9.139.67
105.61.225.59
67.218.229.205
57.102.101.0
235.120.99.90
171.1.128.158
9.149.179.134
148.69.23.245
218.70.12.183
238.210.179.71
18.254.107.222
202.31.59.21
96.152.164.14
2.36.212.105
13.73.128.237
183.23.219.108
122.137.47.216
191.20.122.230
24.1.179.23
25.51.47.44
178.0.37.17
222.122.239.45
161.197.81.65
24.129.240.197
50.194.130.28
250.61.166.42
142.177.85.157
176.255.143.6
65.141.194.185
252.202.145.190
16.179.189.219
97.253.39.247
96.149.198.65
173.113.43.36
86.208.73.130
52.5.145.237
141.157.37.161
3.39.133.235
215.141.182.238
220.33.255.182
24.193.9.186
193.73.186.25
248.236.148.164
65.155.187.209
127.186.213.214
85.50.217.192
232.59.106.152
66.203.82.100
153.22.183.218
114.178.78.160
249.67.204.88
168.3.229.96
51.206.92.149
242.240.161.198
175.224.223.117
215.255.94.148
118.159.67.85
214.98.23.200
98.182.93.198
150.64.0.57
75.216.154.139
49.74.159.213
192.240.103.234
231.101.229.132
124.126.136.163
155.211.245.146
202.108.91.38
56.59.80.75
203.5.18.251
15.25.180.146
6.23.109.210
17.227.229.235
103.126.99.0
10.137.55.50
149.227.87.142
151.112.209.47
164.190.244.53
244.117.237.170
65.45.81.203
121.108.212.20
182.24.185.138
176.224.92.161
246.204.152.237
11.42.221.245
154.228.200.88
250.41.196.254
142.234.172.13
235.3.142.245
229.242.37.67
18.59.1.198
80.255.71.254
101.219.77.110
18.204.247.194
89.176.196.45
38.175.25.27
39.165.133.47
32.198.228.239
164.85.95.155
38.56.55.149
215.61.106.158
252.39.128.134
240.119.197.202
143.36.223.134
163.105.184.243
157.192.89.188
120.158.110.184
81.82.81.46
46.143.102.226
103.200.165.174
177.190.215.225
163.72.195.184
74.216.81.196
48.117.167.200
22.24.108.222
147.137.140.219
201.59.110.238
184.171.58.130
225.217.92.88
17.167.92.218
199.229.75.143
215.133.218.56
97.174.174.10
25.231.188.57
130.56.127.62
124.0.47.222
172.188.225.220
241.132.130.88
24.203.119.233
16.4.180.231
32.165.121.251
79.145.101.58
8.94.236.207
91.35.5.13
106.82.244.132
84.203.54.154
101.90.14.97
120.108.9.34
135.150.186.129
112.184.6.18
77.254.208.228
244.227.127.231
143.207.231.112
147.3.55.251
66.243.178.15
151.255.224.101
40.162.56.196
57.110.49.47
46.15.22.110
134.72.146.90
241.232.223.95
17.197.47.96
161.245.185.255
180.96.224.76
35.231.66.249
16.145.13.63
203.245.158.2
19.76.148.180
61.86.29.255
37.38.243.29
67.153.90.169
80.1.124.86
4.243.57.225
198.200.137.142
223.4.162.188
215.167.96.172
148.91.181.12
9.164.175.36
78.44.142.7
226.179.67.244
234.152.6.5
227.175.5.55
11.56.192.196
45.167.222.81
163.225.197.56
96.88.108.90
193.176.51.57
115.9.84.142
162.64.63.232
56.154.193.234
27.90.20.128
244.202.187.249
129.79.96.146
247.32.22.205
121.111.193.126
87.111.212.91
184.142.192.171
19.119.192.250
144.216.190.188
30.85.2.87
245.121.175.64
65.121.194.218
230.144.187.250
119.44.183.171
28.138.212.153
155.125.255.67
87.213.239.248
116.152.242.143
59.107.172.218
29.63.77.240
151.202.78.18
5.130.178.109
96.34.183.196
219.35.118.28
17.111.163.149
155.73.255.200
70.186.206.90
52.147.58.218
1.18.8.15
137.194.144.109
234.242.158.127
133.184.136.83
105.2.175.132
196.127.4.190
207.87.149.40
11.25.54.254
116.189.159.129
2.184.167.50
36.205.66.91
230.160.88.111
164.151.249.245
5.21.181.202
168.224.212.87
39.212.163.73
10.188.208.24
86.196.128.4
75.127.10.255
189.140.99.169
178.65.20.60
8.80.126.202
193.75.192.12
32.194.70.206
222.152.229.180
25.44.44.162
207.223.236.170
248.222.238.195
168.181.132.50
230.179.41.36
207.158.158.174
204.8.204.87
64.200.186.107
183.216.20.104
121.25.134.165
55.18.86.147
78.244.103.7
157.51.8.200
63.22.125.252
128.166.158.109
230.214.57.158
141.9.157.40
200.170.184.135
94.63.18.192
11.11.119.82
113.2.12.208
192.87.228.155
145.19.83.3
147.6.94.1
68.215.219.205
226.146.24.72
226.61.91.244
47.30.200.159
134.50.179.187
49.1.131.241
252.251.44.129
114.245.58.156
153.67.101.66
91.84.90.183
154.9.186.34
155.97.41.142
13.1.60.71
108.238.131.17
128.79.100.43
57.12.8.113
26.209.80.167
174.204.156.185
222.142.34.139
53.215.250.61
76.233.163.149
52.1.230.198
71.75.215.182
29.43.97.114
149.187.174.85
135.20.129.13
82.182.234.76
32.245.73.128
179.132.199.151
30.42.93.19
145.98.194.154
18.24.249.169
163.246.169.220
155.11.252.90
245.117.153.150
122.167.0.213
200.149.136.87
66.31.17.175
132.10.197.155
199.234.135.60
213.154.15.231
139.104.222.115
138.34.205.106
182.199.3.12
212.78.153.106
20.247.55.139
131.217.203.7
23.2.239.238
252.187.47.64
198.158.193.229
17.155.145.92
169.103.1.134
215.81.164.188
228.20.209.230
213.56.255.57
225.35.149.229
91.53.61.62
173.92.254.106
39.113.63.183
74.118.49.123
124.132.183.196
170.76.230.22
23.53.235.188
222.237.1.192
119.153.200.247
136.120.203.133
150.17.68.160
203.38.235.15
181.65.132.219
15.22.66.66
244.234.54.155
24.179.129.236
177.47.6.53
93.33.71.39
128.73.77.244
108.131.116.175
43.169.82.22
169.39.148.49
119.157.15.94
22.27.102.169
248.9.40.125
225.65.175.200
28.11.75.126
112.244.176.143
122.214.61.200
146.164.131.212
48.29.124.132
53.112.235.98
213.155.228.76
76.21.64.111
209.188.1.224
106.213.247.237
140.20.156.200
48.1.169.148
77.175.181.138
42.249.255.211"""

then = dt.now()
for ip in ip_addresses.split():
    print(r.lookup(ip.strip()))
now = dt.now()

print(now-then)
